<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/fuck_you.gif">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"roricallry.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="本文主要讲述关于数字证书的颁发过程，小型CA项目搭建">
<meta property="og:type" content="article">
<meta property="og:title" content="certificate">
<meta property="og:url" content="https://roricallry.github.io/2024/12/15/certificate/index.html">
<meta property="og:site_name" content="Roricallry&#39;s Blog">
<meta property="og:description" content="本文主要讲述关于数字证书的颁发过程，小型CA项目搭建">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://roricallry.github.io/images/cert.png">
<meta property="article:published_time" content="2024-12-15T09:20:54.000Z">
<meta property="article:modified_time" content="2025-06-07T14:10:27.019Z">
<meta property="article:author" content="Roricallry">
<meta property="article:tag" content="CA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://roricallry.github.io/images/cert.png">


<link rel="canonical" href="https://roricallry.github.io/2024/12/15/certificate/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://roricallry.github.io/2024/12/15/certificate/","path":"2024/12/15/certificate/","title":"certificate"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>certificate | Roricallry's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>
<div class="headband"></div>
<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <a target="_blank" rel="noopener" href="https://github.com/Roricallry" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Roricallry's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">试行中</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%85%AC%E7%A7%81%E9%92%A5"><span class="nav-number">1.</span> <span class="nav-text">创建公私钥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8Ehttps"><span class="nav-number">2.</span> <span class="nav-text">关于https</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">3.</span> <span class="nav-text">服务器部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-tmux"><span class="nav-number">4.</span> <span class="nav-text">使用 tmux</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85-tmux"><span class="nav-number">5.</span> <span class="nav-text">1. 安装 tmux</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%90%AF%E5%8A%A8-tmux-%E4%BC%9A%E8%AF%9D"><span class="nav-number">6.</span> <span class="nav-text">2. 启动 tmux 会话</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%BF%90%E8%A1%8C-Django-%E9%A1%B9%E7%9B%AE"><span class="nav-number">7.</span> <span class="nav-text">3. 运行 Django 项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%88%86%E7%A6%BB-tmux-%E4%BC%9A%E8%AF%9D"><span class="nav-number">8.</span> <span class="nav-text">4. 分离 tmux 会话</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%81%A2%E5%A4%8D%E4%BC%9A%E8%AF%9D"><span class="nav-number">9.</span> <span class="nav-text">5. 恢复会话</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%85%B3%E9%97%AD%E4%BC%9A%E8%AF%9D"><span class="nav-number">10.</span> <span class="nav-text">6. 关闭会话</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SAN-%E5%AD%97%E6%AE%B5%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="nav-number"></span> <span class="nav-text">SAN 字段的作用：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B8%E5%9E%8B%E7%9A%84-SAN-%E5%AD%97%E6%AE%B5%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="nav-number"></span> <span class="nav-text">典型的 SAN 字段内容：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="nav-number"></span> <span class="nav-text">示例：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SAN-%E5%AD%97%E6%AE%B5%E4%B8%8E%E4%BC%A0%E7%BB%9F%E7%9A%84-Common-Name%EF%BC%88CN%EF%BC%89%E5%AD%97%E6%AE%B5%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A"><span class="nav-number"></span> <span class="nav-text">SAN 字段与传统的 Common Name（CN）字段的关系：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="nav-number"></span> <span class="nav-text">在证书申请中的作用：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number"></span> <span class="nav-text">总结：</span></a></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Roricallry"
      src="/images/fuck_you.gif">
  <p class="site-author-name" itemprop="name">Roricallry</p>
  <div class="site-description" itemprop="description">小学生</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:roricallry@gmail.com" title="E-Mail → mailto:roricallry@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://roricallry.github.io/2024/12/15/certificate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fuck_you.gif">
      <meta itemprop="name" content="Roricallry">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Roricallry's Blog">
      <meta itemprop="description" content="小学生">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="certificate | Roricallry's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          certificate
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-15 17:20:54" itemprop="dateCreated datePublished" datetime="2024-12-15T17:20:54+08:00">2024-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-07 22:10:27" itemprop="dateModified" datetime="2025-06-07T22:10:27+08:00">2025-06-07</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>本文主要讲述关于数字证书的颁发过程，小型CA项目搭建</p>
<span id="more"></span>

<p><img src="/images/cert.png" alt="证书"></p>
<h4 id="创建公私钥"><a href="#创建公私钥" class="headerlink" title="创建公私钥"></a>创建公私钥</h4><p>为root_ca生成证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 生成root_ca私钥</span><br><span class="line">openssl genrsa -out root_ca_key.pem 2048</span><br><span class="line"># 生成自签名证书</span><br><span class="line">openssl req -x509 -new -nodes -key root_ca_key.pem -sha256 -days 3650 -out root_ca_cert.pem</span><br></pre></td></tr></table></figure>



<p>为中间ca生成证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 为中间ca创建私钥</span><br><span class="line">openssl genrsa -out intermediate_ca_key.pem 2048</span><br><span class="line"># 为中间ca生成csr文件</span><br><span class="line">openssl req -new -key intermediate_ca_key.pem -out intermediate_ca.csr</span><br></pre></td></tr></table></figure>

<p><strong>生成 SAN 配置文件</strong>(针对后续https，能在浏览器正常打开网页，需配置SAN，不能直接用openssl直接让root给中间ca颁发证书)</p>
<p>创建intermediate_openssl.cnf</p>
<p>&#x2F;&#x2F;若在本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ v3_req ]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[ alt_names ]</span><br><span class="line">DNS.1   = localhost</span><br><span class="line">IP.1    = 127.0.0.1</span><br><span class="line">IP.2    = ::1</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F;若在服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ v3_req ]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[ alt_names ]</span><br><span class="line">IP.1    = 47.106.143.170</span><br></pre></td></tr></table></figure>

<p>使用 root_ca 的私钥和根证书为网站签署一个新的证书：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -in intermediate_ca.csr -CA root_ca_cert.pem -CAkey root_ca_key.pem -CAcreateserial -out intermediate_cert.pem -days 365 -sha256 -extfile intermediate_openssl.cnf -extensions v3_req</span><br></pre></td></tr></table></figure>





<h4 id="关于https"><a href="#关于https" class="headerlink" title="关于https"></a>关于https</h4><p>安装插件 <code>django-sslserver</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-sslserver</span><br></pre></td></tr></table></figure>

<p>检查你的 Django 项目的 <code>settings.py</code> 文件，确保 <code>sslserver</code> 已添加到 <code>INSTALLED_APPS</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    &#x27;sslserver&#x27;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>以及添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SECURE_SSL_REDIRECT = True  # 强制重定向到 HTTPS</span><br><span class="line">SECURE_HSTS_SECONDS = 3600  # 启用 HSTS，设置过期时间</span><br><span class="line">SECURE_HSTS_INCLUDE_SUBDOMAINS = True  # 对子域名启用 HSTS</span><br><span class="line">SECURE_HSTS_PRELOAD = True  # 允许浏览器预加载 HSTS</span><br><span class="line">SECURE_PROXY_SSL_HEADER = (&#x27;HTTP_X_FORWARDED_PROTO&#x27;, &#x27;https&#x27;)  # 代理配置</span><br></pre></td></tr></table></figure>

<p>找到这个文件D:\python3.12\Lib\site-packages\sslserver\management\commands\runsslserver.py</p>
<p>venv&#x2F;lib&#x2F;python3.12&#x2F;site-packages&#x2F;sslserver&#x2F;management&#x2F;commands&#x2F;runsslserver.py</p>
<p>找到下面这段代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class SecureHTTPServer(ThreadedWSGIServer):</span><br><span class="line">    def __init__(self, address, handler_cls, certificate, key, ipv6=False):</span><br><span class="line">        super(SecureHTTPServer, self).__init__(address, handler_cls, ipv6=ipv6)</span><br><span class="line">        self.socket = ssl.wrap_socket(self.socket, certfile=certificate,</span><br><span class="line">                                      keyfile=key, server_side=True,</span><br><span class="line">                                      ssl_version=_ssl_version,</span><br><span class="line">                                      cert_reqs=ssl.CERT_NONE)</span><br></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class SecureHTTPServer(ThreadedWSGIServer):</span><br><span class="line">    def __init__(self, address, handler_cls, certificate, key, ipv6=False):</span><br><span class="line">        super(SecureHTTPServer, self).__init__(address, handler_cls, ipv6=ipv6)</span><br><span class="line">        </span><br><span class="line">        # 创建 SSL 上下文</span><br><span class="line">        context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)</span><br><span class="line">        context.load_cert_chain(certfile=certificate, keyfile=key)</span><br><span class="line">        context.options |= ssl.OP_NO_TLSv1 | ssl.OP_NO_TLSv1_1  # 禁用过时的 TLS 版本</span><br><span class="line"></span><br><span class="line">        # 替换原来的 wrap_socket</span><br><span class="line">        self.socket = context.wrap_socket(self.socket, server_side=True)</span><br></pre></td></tr></table></figure>

<p>说明<br>为什么要用 ssl.SSLContext 替换 ssl.wrap_socket？</p>
<p>​	ssl.wrap_socket 是一种旧方法，已经不推荐使用。ssl.SSLContext 是更现代化、更灵活的方式。<br>​	在 Python 3.12 中，ssl.wrap_socket 可能已经被移除或有兼容性问题。</p>
<p>主要调整点</p>
<p>​	使用 ssl.SSLContext 创建上下文，指定协议为 ssl.PROTOCOL_TLS_SERVER。<br>​	调用 context.load_cert_chain 加载证书和密钥。<br>​	使用 context.wrap_socket 替代 ssl.wrap_socket。</p>
<p>TLS 版本配置</p>
<p>​	使用 context.options |&#x3D; ssl.OP_NO_TLSv1 | ssl.OP_NO_TLSv1_1 禁用过时的 TLS 版本（可选，但推荐）。</p>
<h4 id="服务器部署"><a href="#服务器部署" class="headerlink" title="服务器部署"></a>服务器部署</h4><p>创建一个虚拟环境来隔离项目的 Python 环境，避免修改系统的 Python。</p>
<ol>
<li><p>**安装 <code>python3-venv</code>**（如果未安装）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install python3-venv</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建虚拟环境</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv venv</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>激活虚拟环境</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source venv/bin/activate</span><br></pre></td></tr></table></figure></li>
</ol>
<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py runsslserver 0.0.0.0:443 --certificate /var/www/CA/templates/ca/guet_ca_cert.pem --key /var/www/CA/templates/ca/guet_ca_key.pem</span><br></pre></td></tr></table></figure>



<p>&#x2F;var&#x2F;www&#x2F;CA&#x2F;templates&#x2F;ca&#x2F;root_ca_cert.pem</p>
<p>关闭：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i :8080</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill 【PID】</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<p>要让 Django 项目在阿里云服务器上持续运行，即使你断开与服务器的连接，可以使用一些方法将其作为后台服务运行。常见的方式有使用 <strong><code>tmux</code></strong> 或 **<code>screen</code>**（用于管理终端会话），以及使用 **<code>systemd</code>**（用于设置长期服务）。下面我将介绍几种方法。</p>
<h4 id="使用-tmux"><a href="#使用-tmux" class="headerlink" title="使用 tmux"></a>使用 <code>tmux</code></h4><p><code>tmux</code> 是一个终端复用器，能够让你在后台运行程序并保持其持续运行，即使关闭了 SSH 会话。</p>
<h4 id="1-安装-tmux"><a href="#1-安装-tmux" class="headerlink" title="1. 安装 tmux"></a>1. 安装 <code>tmux</code></h4><p>如果你的服务器上没有安装 <code>tmux</code>，可以先安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash复制代码sudo apt update</span><br><span class="line">sudo apt install tmux</span><br></pre></td></tr></table></figure>

<h4 id="2-启动-tmux-会话"><a href="#2-启动-tmux-会话" class="headerlink" title="2. 启动 tmux 会话"></a>2. 启动 <code>tmux</code> 会话</h4><p>在服务器上创建一个新的 <code>tmux</code> 会话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制代码</span><br><span class="line">tmux new -s my_django_session</span><br></pre></td></tr></table></figure>

<p>这里的 <code>my_django_session</code> 是会话的名字，你可以随意命名。</p>
<h4 id="3-运行-Django-项目"><a href="#3-运行-Django-项目" class="headerlink" title="3. 运行 Django 项目"></a>3. 运行 Django 项目</h4><p>在 <code>tmux</code> 会话中运行你的 Django 项目（例如，使用 <code>runserver</code> 或 <code>runsslserver</code>）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制代码</span><br><span class="line">python3 manage.py runserver 0.0.0.0:8080</span><br></pre></td></tr></table></figure>

<h4 id="4-分离-tmux-会话"><a href="#4-分离-tmux-会话" class="headerlink" title="4. 分离 tmux 会话"></a>4. 分离 <code>tmux</code> 会话</h4><p>你可以按下 <code>Ctrl + B</code>，然后按 <code>D</code>，这会使你“分离”出 <code>tmux</code> 会话，项目继续在后台运行。</p>
<h4 id="5-恢复会话"><a href="#5-恢复会话" class="headerlink" title="5. 恢复会话"></a>5. 恢复会话</h4><p>如果你需要重新连接到 <code>tmux</code> 会话，可以运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制代码</span><br><span class="line">tmux attach -t my_django_session</span><br></pre></td></tr></table></figure>

<h4 id="6-关闭会话"><a href="#6-关闭会话" class="headerlink" title="6. 关闭会话"></a>6. 关闭会话</h4><p>当你不再需要 <code>tmux</code> 会话时，可以输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制代码</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>这将关闭会话并终止 Django 项目。</p>
<p>https默认443端口</p>
<p>django</p>
<p>pymysql</p>
<p>django-sslserver</p>
<p>cryptography</p>
<p>requests</p>
<p>&#x2F;etc&#x2F;apache2&#x2F;sites-enabled&#x2F;000-default.conf</p>
<p>增加重定向</p>
<p># 其他配置项（如果有的话）    ServerName 47.106.143.170     # 重定向 HTTP 到 HTTPS    Redirect permanent &#x2F; <a target="_blank" rel="noopener" href="https://47.106.143.170/">https://47.106.143.170/</a></p>
<p>CA.conf</p>
<p>监听端口443，配置证书跟私钥</p>
<p><strong>SAN（Subject Alternative Name）</strong> 是 SSL&#x2F;TLS 证书中的一个字段，它用于指定证书可以用于多个不同的域名、IP 地址、DNS 名称等。SAN 字段是证书扩展的一部分，允许一个单一的证书支持多个域名或服务。这在很多实际场景中非常有用，尤其是当你希望通过一个证书来保护多个子域名或服务时。</p>
<h3 id="SAN-字段的作用："><a href="#SAN-字段的作用：" class="headerlink" title="SAN 字段的作用："></a>SAN 字段的作用：</h3><ol>
<li><strong>多域名支持</strong>：<ul>
<li>SAN 字段可以包含多个域名，使得一个证书可以同时支持多个不同的域名或子域名。例如，一个证书可以同时保护 <code>example.com</code>、<code>www.example.com</code> 和 <code>blog.example.com</code> 等多个域名。</li>
</ul>
</li>
<li><strong>灵活性</strong>：<ul>
<li>SAN 提供了对多种类型的名称的支持，不仅限于域名（DNS 名称），还可以包括 IP 地址、电子邮件地址等。</li>
<li>对于 IP 地址，可以为服务器的多个 IP 地址生成一个证书，而不必为每个 IP 地址生成单独的证书。</li>
</ul>
</li>
<li><strong>用于不同类型的连接</strong>：<ul>
<li>除了 DNS 名称，SAN 字段还支持诸如 <strong>URI</strong>、<strong>IP 地址</strong>、<strong>电子邮件地址</strong> 等形式的标识符。</li>
</ul>
</li>
</ol>
<h3 id="典型的-SAN-字段内容："><a href="#典型的-SAN-字段内容：" class="headerlink" title="典型的 SAN 字段内容："></a>典型的 SAN 字段内容：</h3><ul>
<li><strong>DNS 名称（DNS Name）</strong>：列出证书所保护的域名或子域名。</li>
<li><strong>IP 地址（IP Address）</strong>：列出证书可以用于的 IP 地址。</li>
<li><strong>电子邮件地址（Email Address）</strong>：证书也可以绑定到特定的电子邮件地址。</li>
</ul>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><p>假设你有一个证书需要保护以下几个域名：</p>
<ul>
<li><code>example.com</code></li>
<li><code>www.example.com</code></li>
<li><code>api.example.com</code></li>
</ul>
<p>在证书的 SAN 字段中，你可以列出这些域名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DNS:example.com</span><br><span class="line">DNS:www.example.com</span><br><span class="line">DNS:api.example.com</span><br></pre></td></tr></table></figure>

<p>此外，假设你希望证书同时支持某个 IP 地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DNS:example.com</span><br><span class="line">DNS:www.example.com</span><br><span class="line">IP:192.168.1.1</span><br></pre></td></tr></table></figure>

<h3 id="SAN-字段与传统的-Common-Name（CN）字段的关系："><a href="#SAN-字段与传统的-Common-Name（CN）字段的关系：" class="headerlink" title="SAN 字段与传统的 Common Name（CN）字段的关系："></a>SAN 字段与传统的 Common Name（CN）字段的关系：</h3><p>在旧版本的 SSL&#x2F;TLS 证书中，<strong>Common Name（CN）</strong> 字段通常用来指定证书所保护的域名。虽然仍然可以在 CN 字段中指定域名，但现代 SSL&#x2F;TLS 证书已经逐步将 SAN 字段作为域名验证的首选方法。</p>
<p><strong>为什么 SAN 更重要：</strong></p>
<ul>
<li><strong>CN 字段的限制</strong>：传统的证书只允许一个 CN，即一个单一的域名，而 SAN 字段可以支持多个域名、IP 地址等。</li>
<li><strong>浏览器和客户端的要求</strong>：现在的大多数浏览器和客户端都要求证书包含 SAN 字段，而 CN 字段已经不再是唯一的验证域名的来源。</li>
</ul>
<h3 id="在证书申请中的作用："><a href="#在证书申请中的作用：" class="headerlink" title="在证书申请中的作用："></a>在证书申请中的作用：</h3><p>当你向证书颁发机构（CA）申请证书时，如果你需要证书保护多个域名或 IP 地址，必须在证书申请中明确列出这些名称，并将它们包含在 SAN 字段中。</p>
<p>例如，使用 <strong>OpenSSL</strong> 工具生成 CSR 时，可以指定 SAN 字段：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ req ]</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">x509_extensions = v3_req</span><br><span class="line"></span><br><span class="line">[ v3_req ]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[ alt_names ]</span><br><span class="line">DNS.1 = example.com</span><br><span class="line">DNS.2 = www.example.com</span><br><span class="line">DNS.3 = api.example.com</span><br></pre></td></tr></table></figure>

<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><ul>
<li><strong>SAN</strong> 是 SSL&#x2F;TLS 证书中的一个扩展字段，用于指定证书所保护的多个域名、IP 地址、电子邮件地址等。</li>
<li>它提供了更大的灵活性，允许一个证书支持多个服务或域名，避免了为每个域名单独申请证书的麻烦。</li>
<li>在现代证书中，SAN 字段比 CN 字段更为重要，因为它可以支持多个名称，并且大多数浏览器和客户端都依赖于 SAN 来验证证书的有效性。</li>
</ul>
<p>apache重启</p>
<p>sudo systemctl restart apache2</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CA/" rel="tag"><i class="fa fa-tag"></i> CA</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/12/11/mysql-server/" rel="prev" title="mysql_server">
                  <i class="fa fa-angle-left"></i> mysql_server
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/04/27/CVE-2024-38816/" rel="next" title="CVE-2024-38816">
                  CVE-2024-38816 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  


</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Roricallry</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->
<!-- 附加  -->


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"Roricallry/comments","repo_id":"R_kgDONKwKlQ","category":"Announcements","category_id":"DIC_kwDONKwKlc4Cj_kW","mapping":"pathname","strict":0,"reactions_enabled":1,"emit_metadata":1,"theme":"light","lang":"en","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-strict'           : CONFIG.giscus.strict,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
